<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>WF Helper Pro</title>
    <!-- Font Awesome CDN for icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <style>
        /* CSS Variables for easy theming */
        :root {
            --primary-color: #00bcd4; /* Teal */
            --primary-dark: #0097a7;
            --secondary-color: #4CAF50; /* Green */
            --danger-color: #f44336; /* Red */
            --background-gradient-start: #0f2027;
            --background-gradient-mid: #203a43;
            --background-gradient-end: #2c5364;
            --card-background: rgba(255, 255, 255, 0.08);
            --card-background-blur: rgba(255, 255, 255, 0.05);
            --text-color: #f0f0f0;
            --input-background: rgba(255, 255, 255, 0.15);
            --input-border: var(--primary-color);
            --input-focus-background: rgba(255, 255, 255, 0.25);
            --shadow-light: rgba(0, 0, 0, 0.3);
            --shadow-medium: rgba(0, 0, 0, 0.5);
            --shadow-heavy: rgba(0, 0, 0, 0.7);
            --border-radius-small: 8px;
            --border-radius-medium: 12px;
            --border-radius-large: 25px;
        }

        /* Global Styles */
        *, *::before, *::after {
            box-sizing: border-box; /* Ensure consistent box model */
        }

        body {
            font-family: "Segoe UI", "Arial", sans-serif;
            background: linear-gradient(135deg, var(--background-gradient-start), var(--background-gradient-mid), var(--background-gradient-end));
            margin: 0;
            padding: 20px;
            color: var(--text-color);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            overflow-x: hidden; /* Prevent horizontal scroll */
            position: relative; /* For toast notifications */
        }

        /* Typography */
        h1 {
            color: var(--primary-color);
            margin-bottom: 30px;
            text-shadow: 0 0 20px var(--primary-color), 0 0 10px var(--shadow-heavy);
            font-size: 4em; /* Larger, more impactful */
            letter-spacing: 3px;
            text-align: center;
            width: 100%;
            font-weight: 700;
            animation: fadeInDown 1s ease-out;
        }

        @keyframes fadeInDown {
            from { opacity: 0; transform: translateY(-30px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Tabs Navigation */
        .tabs {
            display: flex;
            justify-content: center;
            margin-bottom: 30px;
            flex-wrap: wrap;
            width: 100%;
            max-width: 700px; /* Slightly wider tabs */
            gap: 10px; /* Space between tabs */
        }

        .tab {
            padding: 12px 25px;
            cursor: pointer;
            background: var(--card-background);
            border: 1px solid var(--primary-color);
            border-radius: var(--border-radius-medium);
            transition: all 0.3s ease-in-out;
            flex-grow: 1;
            text-align: center;
            min-width: 150px; /* Larger min-width */
            font-weight: 600;
            font-size: 1.1em;
            box-shadow: 0 4px 15px var(--shadow-light);
            position: relative;
            overflow: hidden;
        }

        .tab::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.1), transparent);
            transition: all 0.5s ease;
        }

        .tab:hover::before {
            left: 100%;
        }

        .tab:hover {
            background: var(--input-focus-background);
            transform: translateY(-3px) scale(1.02);
            box-shadow: 0 8px 25px var(--shadow-medium);
            border-color: var(--primary-dark);
        }

        .tab.active {
            background: var(--primary-color);
            color: #1c1c1c;
            box-shadow: 0 6px 20px var(--primary-color);
            transform: translateY(-2px);
            border-color: var(--primary-color);
        }

        /* Main Content Container */
        .container {
            background: var(--card-background);
            backdrop-filter: blur(15px);
            border-radius: var(--border-radius-large);
            box-shadow: 0 15px 40px var(--shadow-heavy);
            padding: 40px 50px;
            max-width: 700px; /* Wider container */
            width: 100%;
            transition: transform 0.5s ease-out, opacity 0.5s ease-out;
            margin: 0 auto 30px auto; /* Add bottom margin */
            border: 1px solid rgba(255, 255, 255, 0.1); /* Subtle border */
        }

        /* Form Elements */
        label {
            font-weight: bold;
            margin-top: 20px;
            display: block;
            color: var(--primary-color);
            font-size: 1.25em; /* Slightly larger labels */
            margin-bottom: 8px;
        }

        textarea, input, select {
            width: 100%;
            padding: 15px;
            border-radius: var(--border-radius-medium);
            border: 1px solid var(--input-border);
            font-size: 1.1em;
            background: var(--input-background);
            color: var(--text-color);
            transition: all 0.3s ease;
            box-shadow: inset 0 1px 5px var(--shadow-light);
        }

        textarea:focus, input:focus, select:focus {
            border-color: var(--primary-dark);
            background: var(--input-focus-background);
            outline: none;
            box-shadow: 0 0 0 3px rgba(0, 188, 212, 0.3), inset 0 1px 5px var(--shadow-medium);
        }

        select {
            color: var(--text-color); /* Keep text white for select */
            -webkit-appearance: none; /* Remove default arrow */
            -moz-appearance: none;
            appearance: none;
            background-image: url('data:image/svg+xml;charset=US-ASCII,%3Csvg%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20width%3D%22292.4%22%20height%3D%22292.4%22%3E%3Cpath%20fill%3D%22%2300bcd4%22%20d%3D%22M287%2C114.7L159.7%2C242c-3.2%2C3.2-8.3%2C3.2-11.5%2C0L5.4%2C114.7c-3.2-3.2-3.2-8.3%2C0-11.5l11.5-11.5c3.2-3.2%2C8.3-3.2%2C11.5%2C0l115.5%2C115.5l115.5-115.5c3.2-3.2%2C8.3-3.2%2C11.5%2C0l11.5%2C11.5C290.2%2C106.4%2C290.2%2C111.5%2C287%2C114.7z%22%2F%3E%3C%2Fsvg%3E');
            background-repeat: no-repeat;
            background-position: right 15px center;
            background-size: 12px;
            padding-right: 40px; /* Make space for the custom arrow */
        }

        option {
            background-color: var(--background-gradient-mid); /* Darker background for options */
            color: var(--text-color);
        }

        ::placeholder {
            color: rgba(255, 255, 255, 0.6);
            opacity: 1;
        }

        /* Main Buttons */
        button {
            margin-top: 30px;
            padding: 18px 35px; /* Larger padding */
            background-color: var(--primary-color);
            color: #1c1c1c;
            border: none;
            border-radius: var(--border-radius-medium);
            font-size: 1.3em; /* Larger font */
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease-in-out;
            box-shadow: 0 8px 25px var(--primary-color); /* Stronger shadow */
            width: 100%;
            max-width: 350px; /* Wider button */
            display: block;
            margin-left: auto;
            margin-right: auto;
            position: relative;
            overflow: hidden;
            z-index: 1;
            letter-spacing: 0.5px;
            display: flex; /* Use flexbox for icon and text alignment */
            align-items: center;
            justify-content: center;
        }

        button i {
            margin-right: 8px; /* Space between icon and text */
        }

        button::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(45deg, rgba(255,255,255,0.2) 0%, rgba(255,255,255,0.0) 100%);
            transform: translateX(-100%);
            transition: transform 0.5s ease-out;
            z-index: -1;
        }

        button:hover::before {
            transform: translateX(0%);
        }

        button:hover {
            background-color: var(--primary-dark);
            transform: translateY(-4px) scale(1.02); /* More pronounced lift */
            box-shadow: 0 12px 35px var(--primary-dark);
            color: #fff; /* White text on hover for contrast */
        }

        button:active {
            transform: translateY(0);
            box-shadow: 0 5px 15px var(--shadow-medium);
        }

        /* Results Area */
        .results {
            margin-top: 40px;
            width: 100%;
        }

        .agent-block {
            background: var(--card-background);
            padding: 20px;
            margin-bottom: 15px;
            border-left: 5px solid var(--primary-color);
            border-radius: var(--border-radius-medium);
            box-shadow: 0 5px 15px var(--shadow-light);
            transition: all 0.3s ease;
            position: relative;
            display: flex;
            flex-wrap: wrap;
            align-items: center;
            justify-content: space-between;
            overflow: hidden; /* For subtle glow effect */
        }

        .agent-block::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: radial-gradient(circle at 10% 10%, rgba(0,188,212,0.1), transparent 70%);
            opacity: 0;
            transition: opacity 0.5s ease;
            pointer-events: none;
        }

        .agent-block:hover::before {
            opacity: 1;
        }

        .agent-block:hover {
            transform: translateY(-3px) scale(1.01);
            box-shadow: 0 8px 20px var(--shadow-medium);
            border-left-color: var(--primary-dark);
        }

        .agent-block strong {
            color: var(--primary-color);
            font-size: 1.3em;
            flex-basis: 100%;
            margin-bottom: 8px;
            font-weight: 600;
        }

        .agent-block span {
            flex-grow: 1;
            margin-right: 15px;
            font-size: 1.05em;
        }

        /* Action Buttons within Agent Blocks */
        .edit-button, .delete-button, .done-button {
            background: transparent;
            border: 1px solid transparent;
            color: var(--primary-color);
            cursor: pointer;
            font-size: 1.2em; /* Larger icons */
            margin-left: 8px;
            padding: 8px; /* More padding for click area */
            border-radius: var(--border-radius-small);
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
            z-index: 1;
            flex-shrink: 0;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 40px; /* Larger square buttons */
            height: 40px;
            box-shadow: 0 2px 8px var(--shadow-light);
        }

        .edit-button::before, .delete-button::before, .done-button::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(45deg, rgba(255,255,255,0.1) 0%, rgba(255,255,255,0.0) 100%);
            transform: translateX(-100%);
            transition: transform 0.5s ease-out;
            z-index: -1;
        }

        .edit-button:hover::before, .delete-button:hover::before, .done-button:hover::before {
            transform: translateX(0%);
        }

        .edit-button:hover {
            background-color: rgba(0, 188, 212, 0.2);
            border-color: var(--primary-color);
            box-shadow: 0 6px 18px rgba(0, 188, 212, 0.4);
            transform: translateY(-2px) scale(1.1);
            color: #fff;
        }

        .delete-button {
            color: var(--danger-color);
        }

        .delete-button:hover {
            background-color: rgba(244, 67, 54, 0.2);
            border-color: var(--danger-color);
            box-shadow: 0 6px 18px rgba(244, 67, 54, 0.4);
            transform: translateY(-2px) scale(1.1);
            color: #fff;
        }

        .done-button {
            color: var(--secondary-color);
        }

        .done-button:hover {
            background-color: rgba(76, 175, 80, 0.2);
            border-color: var(--secondary-color);
            box-shadow: 0 6px 18px rgba(76, 175, 80, 0.4);
            transform: translateY(-2px) scale(1.1);
            color: #fff;
        }

        /* Report Output */
        .report-output {
            background: var(--card-background);
            padding: 25px;
            border-radius: var(--border-radius-medium);
            margin-top: 30px;
            white-space: pre-wrap;
            word-wrap: break-word;
            border: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: 0 5px 15px var(--shadow-light);
            line-height: 1.6;
            font-size: 1.05em;
        }

        /* Expectations Message */
        .expectations-message {
            margin-top: 25px;
            padding: 20px;
            background: rgba(0, 188, 212, 0.15);
            border-left: 5px solid var(--primary-color);
            border-radius: var(--border-radius-medium);
            color: #e0f7fa;
            font-size: 1.1em;
            line-height: 1.6;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.2);
        }

        .expectations-message strong {
            color: var(--primary-color);
            font-size: 1.1em;
        }

        .expectations-message ul {
            list-style: none;
            padding: 0;
            margin-top: 10px;
        }

        .expectations-message li {
            padding: 5px 0;
            border-bottom: 1px dashed rgba(255, 255, 255, 0.1);
        }

        .expectations-message li:last-child {
            border-bottom: none;
        }

        /* Collapsible Sections */
        .schedule-section {
            margin-top: 25px;
            border: 1px solid var(--primary-color);
            border-radius: var(--border-radius-medium);
            overflow: hidden;
            box-shadow: 0 8px 25px var(--shadow-medium);
            background: var(--card-background);
            transition: all 0.3s ease;
        }

        .schedule-section:hover {
            transform: translateY(-3px);
            box-shadow: 0 12px 35px var(--shadow-heavy);
        }

        .schedule-header {
            background: rgba(0, 188, 212, 0.25);
            padding: 18px 25px;
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-weight: bold;
            font-size: 1.4em; /* Larger header */
            color: #e0f7fa;
            border-bottom: 1px solid rgba(0, 188, 212, 0.3);
            transition: background 0.3s ease;
        }

        .schedule-header:hover {
            background: rgba(0, 188, 212, 0.35);
        }

        .schedule-header i {
            transition: transform 0.4s ease;
            font-size: 0.9em;
        }

        .schedule-header.hidden-content i {
            transform: rotate(-90deg);
        }

        .schedule-content {
            padding: 0 25px;
            overflow-y: auto;
            max-height: 0; /* Start collapsed */
            transition: max-height 0.5s ease-out, padding 0.5s ease-out;
            will-change: max-height; /* Optimize for animation */
        }

        .schedule-content.expanded {
            max-height: 500px; /* Sufficiently large for content */
            padding: 20px 25px;
        }

        /* Toast Notifications */
        .toast-container {
            position: fixed;
            bottom: 20px;
            right: 20px;
            z-index: 1000;
            display: flex;
            flex-direction: column-reverse; /* Newest on top */
            gap: 10px;
        }

        .toast {
            background-color: rgba(50, 50, 50, 0.9);
            color: var(--text-color);
            padding: 15px 20px;
            border-radius: var(--border-radius-medium);
            box-shadow: 0 5px 15px var(--shadow-heavy);
            display: flex;
            align-items: center;
            gap: 10px;
            opacity: 0;
            transform: translateY(20px);
            animation: toastIn 0.5s forwards, toastOut 0.5s forwards 3s; /* In, then out after 3s */
            min-width: 250px;
            max-width: 350px;
            border-left: 5px solid var(--primary-color);
        }

        .toast.success { border-left-color: var(--secondary-color); }
        .toast.error { border-left-color: var(--danger-color); }
        .toast.info { border-left-color: var(--primary-color); }

        /* New style for break alarm toast */
        .toast.break-alarm {
            background-color: rgba(255, 165, 0, 0.9); /* Orange background */
            color: #1c1c1c; /* Dark text for contrast */
            border-left-color: #ff4500; /* Red-orange border */
            box-shadow: 0 8px 25px rgba(255, 165, 0, 0.7); /* Stronger shadow */
            font-weight: bold;
            animation: toastIn 0.5s forwards, toastOut 0.5s forwards 8s; /* Stay longer */
            transform: scale(1.05); /* Slightly larger */
        }

        .toast.break-alarm i {
            color: #ff4500; /* Icon color matching border */
        }


        @keyframes toastIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        @keyframes toastOut {
            from { opacity: 1; transform: translateY(0); }
            to { opacity: 0; transform: translateY(20px); }
        }

        /* New styles for compact report input fields */
        .report-input-grid {
            display: grid;
            /* Adjust grid columns: first column for labels, second for inputs */
            grid-template-columns: 1fr minmax(50px, 100px); /* Label takes flexible space, input fixed/max width */
            gap: 10px 20px; /* Row gap, column gap */
            align-items: center;
            margin-top: 20px;
        }

        .report-input-grid .form-group-inline {
            display: contents; /* Makes children participate in the grid directly */
        }

        .report-input-grid label {
            margin-top: 0; /* Remove top margin as grid handles spacing */
            margin-bottom: 0;
            font-size: 1.1em; /* Slightly smaller for compactness */
            text-align: left; /* Keep labels left-aligned */
            white-space: nowrap; /* Prevent labels from wrapping */
            padding-right: 10px; /* Add some space between label and input */
        }

        .report-input-grid input[type="number"] {
            width: 100%; /* Fill the grid column */
            max-width: 100px; /* Limit width for number inputs */
            text-align: center; /* Center the numbers */
            padding: 8px 12px; /* Smaller padding for compactness */
            font-size: 1em;
            justify-self: end; /* Align input to the end of its grid cell (right) */
        }

        /* Attendance Status Specific Styles */
        .attendance-entry {
            background: var(--card-background);
            padding: 15px; /* Slightly less padding than agent-block */
            margin-bottom: 10px; /* Slightly less margin */
            border-left: 5px solid var(--primary-color);
            border-radius: var(--border-radius-medium);
            box-shadow: 0 3px 10px var(--shadow-light); /* Lighter shadow */
            transition: all 0.3s ease;
            display: flex;
            flex-wrap: wrap;
            align-items: center;
            justify-content: space-between;
        }

        .attendance-entry strong {
            color: var(--primary-color); /* Keep primary color for name */
            font-size: 1.1em; /* Slightly smaller font for compactness */
            flex-basis: auto; /* Allow name to take necessary space */
            margin-right: 10px; /* Space between name and select */
            flex-grow: 1; /* Allow name to grow */
            word-wrap: break-word; /* Allow long names to wrap */
        }

        .attendance-entry .actions {
            display: flex;
            gap: 5px;
            flex-shrink: 0; /* Prevent actions from shrinking */
        }

        .attendance-entry .actions button {
            margin-top: 0;
            padding: 5px 10px;
            font-size: 0.9em;
            max-width: unset;
            width: auto;
            box-shadow: none;
        }

        .attendance-entry select {
            width: auto; /* Allow select to size based on content */
            max-width: 180px; /* Limit width for better layout */
            margin-right: 10px;
            padding: 8px 12px;
            font-size: 0.95em;
            background-position: right 8px center; /* Adjust arrow position */
            padding-right: 30px; /* Adjust padding for arrow */
            flex-shrink: 0; /* Prevent select from shrinking */
        }

        /* New style for break separators */
        .break-separator {
            margin-top: 25px;
            margin-bottom: 15px;
            padding-bottom: 5px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.2);
            color: var(--primary-color);
            font-size: 1.2em;
            font-weight: bold;
            text-align: center;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        /* Media Queries for Responsiveness */
        @media (max-width: 768px) {
            body {
                padding: 15px;
            }

            h1 {
                font-size: 3em;
                margin-bottom: 20px;
            }

            .container {
                padding: 30px 35px;
                border-radius: var(--border-radius-large);
            }

            .tabs {
                flex-direction: column;
                align-items: stretch;
                max-width: 100%;
            }

            .tab {
                margin: 5px 0;
                padding: 15px 20px;
                min-width: unset; /* Allow tabs to shrink more */
            }

            button {
                font-size: 1.2em;
                padding: 15px 25px;
                max-width: 100%; /* Ensure buttons can take full width */
            }

            .agent-block {
                flex-direction: column;
                align-items: flex-start;
                padding: 15px;
            }

            .agent-block strong {
                font-size: 1.2em;
                margin-bottom: 5px;
            }

            .agent-block span {
                margin-right: 0;
                margin-bottom: 10px;
            }

            .edit-button, .delete-button, .done-button {
                width: 36px;
                height: 36px;
                font-size: 1.1em;
                padding: 6px;
                margin-left: 0;
                margin-top: 10px;
            }

            .schedule-header {
                font-size: 1.2em;
                padding: 15px 20px;
            }

            .schedule-content.expanded {
                padding: 15px 20px;
            }

            .toast-container {
                bottom: 10px;
                right: 10px;
                left: 10px; /* Full width on small screens */
                flex-direction: column; /* Newest on bottom for better visibility */
            }

            .toast {
                min-width: unset;
                max-width: unset;
                width: auto;
            }

            .report-input-grid {
                grid-template-columns: 1fr; /* Stack on small screens */
                gap: 5px;
            }

            .report-input-grid label {
                text-align: left; /* Align labels to left when stacked */
                padding-right: 0; /* Remove padding when stacked */
            }

            .report-input-grid input[type="number"] {
                max-width: 100%; /* Allow full width on small screens */
                justify-self: stretch; /* Stretch to fill width */
            }

            /* Attendance Status specific responsiveness */
            .attendance-entry {
                flex-direction: column;
                align-items: flex-start;
            }
            .attendance-entry strong {
                margin-bottom: 5px;
            }
            .attendance-entry .actions {
                width: 100%;
                justify-content: flex-end;
            }
            .attendance-entry select {
                width: 100%;
                max-width: unset;
                margin-right: 0;
                margin-bottom: 10px;
            }
        }

        @media (max-width: 480px) {
            h1 {
                font-size: 2.5em;
                letter-spacing: 1px;
            }

            .container {
                padding: 25px 20px;
            }

            label {
                font-size: 1.1em;
            }

            textarea, input, select {
                padding: 12px;
                font-size: 1em;
            }

            button {
                font-size: 1.1em;
                padding: 12px 20px;
            }

            .edit-button, .delete-button, .done-button {
                width: 32px;
                height: 32px;
                font-size: 1em;
                padding: 4px;
            }

            .expectations-message {
                font-size: 1em;
                padding: 15px;
            }

            .report-output {
                font-size: 0.95em;
                padding: 20px;
            }
        }

        /* Additional responsiveness for form elements and buttons */
        /* Ensure inputs and textareas take full width on smaller screens */
        @media (max-width: 600px) {
            textarea, input[type="text"], input[type="number"], input[type="time"], select {
                width: 100%;
                min-width: unset; /* Remove any min-width constraints */
            }

            /* Adjust button max-width to be more flexible */
            button {
                max-width: 100%;
                padding: 15px 20px; /* Slightly reduce padding for smaller buttons */
                font-size: 1.1em; /* Slightly reduce font size */
            }

            /* Adjust label margins for better spacing on small screens */
            label {
                margin-top: 15px;
                margin-bottom: 5px;
            }

            /* Ensure the report input grid stacks properly */
            .report-input-grid {
                grid-template-columns: 1fr; /* Stack labels and inputs vertically */
                gap: 10px; /* Increase gap for better readability */
            }

            .report-input-grid label {
                text-align: left; /* Align labels to the left when stacked */
                padding-right: 0; /* Remove padding */
            }

            .report-input-grid input[type="number"] {
                max-width: 100%; /* Allow number inputs to take full width */
                text-align: left; /* Align numbers to the left when stacked */
            }
        }
        /* Styles for the new Switch Template tab */
        .template-buttons {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .template-buttons button {
            margin-top: 0; /* Override default button margin */
            padding: 15px 20px;
            font-size: 1.1em;
            max-width: unset; /* Allow buttons to fill grid space */
        }

        /* Styles for Agent Configuration Tab */
        .agent-config-entry {
            background: var(--card-background);
            padding: 15px;
            margin-bottom: 10px;
            border-left: 5px solid var(--secondary-color); /* Different color for config */
            border-radius: var(--border-radius-medium);
            box-shadow: 0 3px 10px var(--shadow-light);
            display: flex;
            flex-direction: column; /* Stack name and slots vertically */
            gap: 10px; /* Space between elements */
        }

        .agent-config-entry strong {
            color: var(--secondary-color);
            font-size: 1.1em;
            margin-bottom: 5px;
            word-break: break-word; /* Allow long names to wrap */
            flex-grow: 1; /* Allow name to take available space */
        }

        .agent-config-entry .break-slot-container {
            display: flex;
            flex-wrap: wrap; /* Allow items to wrap */
            gap: 10px;
            align-items: center;
            padding: 5px 0;
            border-top: 1px dashed rgba(255, 255, 255, 0.1);
        }

        .agent-config-entry .break-slot-container:first-of-type {
            border-top: none; /* No border for the first slot */
        }

        .agent-config-entry .break-slot-container select,
        .agent-config-entry .break-slot-container input[type="text"] {
            flex-grow: 1; /* Allow selects and inputs to grow */
            min-width: 100px; /* Minimum width for selects/inputs */
            max-width: 180px; /* Max width for selects/inputs */
            padding: 8px 12px;
            font-size: 0.95em;
            margin-top: 0; /* Remove default margin */
        }

        .agent-config-entry .break-slot-container .remove-slot-button {
            margin-top: 0;
            padding: 5px 10px;
            font-size: 0.9em;
            max-width: unset;
            width: auto;
            box-shadow: none;
            background-color: var(--danger-color); /* Red for remove button */
            color: #fff;
        }

        .agent-config-entry .add-slot-button {
            margin-top: 10px;
            padding: 8px 15px;
            font-size: 0.95em;
            max-width: 200px; /* Smaller add slot button */
            background-color: var(--primary-color);
            color: #1c1c1c;
            box-shadow: none;
        }

        .agent-config-entry .actions {
            display: flex;
            justify-content: flex-end; /* Align delete button to the right */
            margin-top: 10px;
        }

        .agent-config-entry .actions button {
            margin-top: 0;
            padding: 5px 10px;
            font-size: 0.9em;
            max-width: unset;
            width: auto;
            box-shadow: none;
        }

        /* Responsive adjustments for agent config */
        @media (max-width: 768px) {
            .agent-config-entry {
                padding: 10px;
            }
            .agent-config-entry .break-slot-container {
                flex-direction: column;
                align-items: stretch;
            }
            .agent-config-entry .break-slot-container select,
            .agent-config-entry .break-slot-container input[type="text"] {
                width: 100%;
                max-width: unset;
            }
            .agent-config-entry .add-slot-button {
                width: 100%;
                max-width: unset;
            }
            .agent-config-entry .actions {
                width: 100%;
                justify-content: flex-end;
            }
        }

        /* Specific styles for Switch Template buttons to ensure consistent sizing */
        .template-buttons button {
            display: flex;
            align-items: center;
            justify-content: center;
            text-align: center;
            white-space: nowrap; /* Prevent text from wrapping */
            overflow: hidden;
            text-overflow: ellipsis; /* Add ellipsis for overflow */
            min-height: 50px; /* Ensure a minimum height for consistency */
        }

        .template-buttons button i {
            margin-right: 8px;
        }

        /* Styles for Backlog Template */
        .backlog-output {
            background: var(--card-background);
            padding: 25px;
            border-radius: var(--border-radius-medium);
            margin-top: 30px;
            white-space: pre-wrap;
            word-wrap: break-word;
            border: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: 0 5px 15px var(--shadow-light);
            line-height: 1.6;
            font-size: 1.05em;
        }

        .backlog-output h3 {
            text-align: center;
            color: var(--primary-color);
            margin-bottom: 20px;
        }

        .backlog-output p {
            margin-bottom: 10px;
        }

        .backlog-time-input-group {
            display: flex;
            align-items: center;
            margin-bottom: 10px;
            gap: 10px;
        }

        .backlog-time-input-group label {
            margin: 0;
            min-width: 80px; /* Adjust as needed */
            font-size: 1em;
            color: var(--text-color);
        }

        .backlog-time-input-group input[type="number"] {
            width: 70px; /* Fixed width for hour input */
            padding: 8px 12px;
            font-size: 1em;
            text-align: center;
            margin-top: 0;
        }

        .backlog-time-input-group span {
            font-size: 1em;
            color: var(--text-color);
        }

        /* New styles for attendance report output */
        .attendance-report-output-container {
            background: var(--card-background);
            padding: 25px;
            border-radius: var(--border-radius-medium);
            margin-top: 30px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: 0 5px 15px var(--shadow-light);
            line-height: 1.6;
            font-size: 1.05em;
        }

        .attendance-report-output-container h4 {
            color: var(--primary-color);
            margin-top: 15px;
            margin-bottom: 10px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            padding-bottom: 5px;
        }

        .attendance-report-output-container ul {
            list-style: disc;
            margin-left: 20px;
            padding: 0;
        }

        .attendance-report-output-container ul ul {
            list-style: circle;
            margin-left: 20px;
            margin-top: 5px;
        }

        .attendance-report-output-container li {
            margin-bottom: 5px;
        }
    </style>
</head>
<body>

    <h1>WF Helper <span style="font-size: 0.6em; vertical-align: super; font-weight: normal;">PRO</span></h1>
    <div class="tabs">
        <div class="tab active" onclick="showTab('tasks')">IM Tasks</div>
        <div class="tab" onclick="showTab('report')">Report Generator</div>
        <div class="tab" onclick="showTab('attendance')">Attendance Report</div>
        <div class="tab" onclick="showTab('outage')">Outage Report</div>
        <div class="tab" onclick="showTab('intradayTraffic')">Intraday Traffic</div>
        <div class="tab" onclick="showTab('switchTemplate')">Switch Template</div>
        <div class="tab" onclick="showTab('agentConfig')">Break Schedule</div>
        <div class="tab" onclick="showTab('backlogTemplate')">Backlog Template</div> <!-- New Tab -->
    </div>

    <div class="container" id="tasks">
        <label for="agents">Enter Agent Names with Break Times (one per line, format: Name, Break Time):</label>
        <textarea id="agents" rows="6" placeholder="e.g. John Doe, 10:00&#10;Jane Smith, 10:15&#10;Alex Johnson, 09:45"></textarea>

        <label for="taskCount">Enter Total IM Task Volume:</label>
        <input type="number" id="taskCount" min="1" placeholder="e.g. 12" />

        <label for="shiftSchedule">Select Shift Schedule:</label>
        <select id="shiftSchedule">
            <option value="8PM">8:00 PM</option>
            <option value="10PM">10:00 PM</option>
            <option value="10:30PM">10:30 PM</option>
            <option value="3AM">3:00 AM</option>
            <option value="5AM">5:00 AM</option>
        </select>

        <button onclick="generateSkills()">Generate IM Assignment</button>

        <div class="results" id="results"></div>
    </div>

    <div class="container" id="report" style="display: none;">
        <div class="report-input-grid">
            <div class="form-group-inline">
                <label for="imQueueTasks">IM Queue Waiting:</label>
                <input type="number" id="imQueueTasks" min="0" value="0" />
            </div>

            <div class="form-group-inline">
                <label for="imAgentsWorking">IM Agents Working:</label>
                <input type="number" id="imAgentsWorking" min="0" value="0" />
            </div>

            <div class="form-group-inline">
                <label for="ticketQueueTasks">Ticket Queue Waiting:</label>
                <input type="number" id="ticketQueueTasks" min="0" value="0" />
            </div>

            <div class="form-group-inline">
                <label for="ticketAgentsWorking">Ticket Agents Working:</label>
                <input type="number" id="ticketAgentsWorking" min="0" value="0" />
            </div>

            <div class="form-group-inline">
                <label for="agentsOnBreak">Agents on Break:</label>
                <input type="number" id="agentsOnBreak" min="0" value="0" />
            </div>

            <div class="form-group-inline">
                <label for="agentsOnLunch">Agents on Lunch:</label>
                <input type="number" id="agentsOnLunch" min="0" value="0" />
            </div>

            <div class="form-group-inline">
                <label for="agentsOnCoaching">Agents on Coaching:</label>
                <input type="number" id="agentsOnCoaching" min="0" value="0" />
            </div>

            <div class="form-group-inline">
                <label for="agentsOnMeeting">Agents on Meeting:</label>
                <input type="number" id="agentsOnMeeting" min="0" value="0" />
            </div>

            <div class="form-group-inline">
                <label for="agentsOnTraining">Agents on Training:</label>
                <input type="number" id="agentsOnTraining" min="0" value="0" />
            </div>
        </div>

        <button onclick="generateReport()">Generate Report</button>
        <button onclick="generateUSTBacklog()">Generate UST Backlog</button>
        <button onclick="generatePHBacklog()">Generate PH Backlog</button>
        <button onclick="generateReminder()">Generate Reminder</button>
        <button onclick="generateHandlingCO()">Generate Handling CO</button>


        <div class="report-output" id="reportOutput"></div>
        <!-- New Copy Button -->
        <button onclick="copyReport()" style="margin-top: 20px;"><i class="fas fa-copy"></i> Copy Report</button>
    </div>

    <div class="container" id="attendance" style="display: none;">
        <label for="attendanceNames">Enter Agent Names (one per line):</label>
        <textarea id="attendanceNames" rows="6" placeholder="e.g. John Doe&#10;Jane Smith&#10;Alex Johnson"></textarea>

        <label for="attendanceShiftSchedule">Select Shift Schedule:</label>
        <select id="attendanceShiftSchedule">
            <option value="8PM">8:00 PM</option>
            <option value="10PM">10:00 PM</option>
            <option value="10:30PM">10:30 PM</option>
            <option value="3AM">3:00 AM</option>
            <option value="5AM">5:00 AM</option>
        </select>

        <button onclick="addAttendanceEntries()">Add Attendance Entries</button>

        <div class="results" id="attendanceResults">
            <!-- Attendance entries will be dynamically added here -->
        </div>

        <button onclick="generateAttendanceReport()">Generate Attendance Report</button>
        <div class="report-output attendance-report-output-container" id="attendanceReportOutput"></div>
        <button onclick="copyAttendanceReport()" style="margin-top: 20px;"><i class="fas fa-copy"></i> Copy Attendance Report</button>
    </div>

    <div class="container" id="outage" style="display: none;">
        <label for="outageAccount">Account:</label>
        <select id="outageAccount">
            <option value="ByteDance - USDS">ByteDance - USDS</option>
            <!-- Add more accounts here if needed -->
        </select>

        <label for="outageStartTime">Outage start date and time:</label>
        <input type="datetime-local" id="outageStartTime" />

        <label for="outageAffected">Affected:</label>
        <textarea id="outageAffected" rows="4" placeholder="e.g. All agents, specific queues, specific regions"></textarea>

        <label for="outageSide">Client side/CNX side:</label>
        <select id="outageSide">
            <option value="Client side">Client side</option>
            <option value="CNX side">CNX side</option>
        </select>

        <label for="outageAssistCustomer">Can we still assist customer:</label>
        <select id="outageAssistCustomer">
            <option value="Yes">Yes</option>
            <option value="No">No</option>
        </select>

        <label for="outageB2PAffecting">B2P affecting, yes or no:</label>
        <select id="outageB2PAffecting">
            <option value="Yes">Yes</option>
            <option value="No">No</option>
        </select>

        <label for="outageDescription">Short description of the outage:</label>
        <textarea id="outageDescription" rows="4" placeholder="e.g. IM queue is down, login issues"></textarea>

        <label for="outageStatus">Status:</label>
        <select id="outageStatus">
            <option value="Ongoing">Ongoing</option>
            <option value="Resolved">Resolved</option>
            <option value="Investigating">Investigating</option>
            <option value="Monitoring">Monitoring</option>
            <option value="Escalated">Escalated</option>
        </select>

        <button onclick="generateOutageReport()">Generate Outage Report</button>

        <div class="report-output" id="outageReportOutput"></div>
        <button onclick="copyOutageReport()" style="margin-top: 20px;"><i class="fas fa-copy"></i> Copy Outage Report</button>
    </div>

    <div class="container" id="intradayTraffic" style="display: none;">
        <label for="imInbound">IM Inbound:</label>
        <input type="number" id="imInbound" min="0" value="0" />

        <label for="imForecast">IM Forecast:</label>
        <input type="number" id="imForecast" min="0" value="0" />

        <label for="ticketInbound">Ticket Inbound:</label>
        <input type="number" id="ticketInbound" min="0" value="0" />

        <label for="ticketForecast">Ticket Forecast:</label>
        <input type="number" id="ticketForecast" min="0" value="0" />

        <button onclick="generateIntradayTrafficReport()">Generate Intraday Traffic Report</button>

        <div class="report-output" id="intradayTrafficReportOutput"></div>
        <button onclick="copyIntradayTrafficReport()" style="margin-top: 20px;"><i class="fas fa-copy"></i> Copy Intraday Traffic Report</button>
    </div>

    <div class="container" id="switchTemplate" style="display: none;">
        <label>Select a template to generate:</label>
        <div class="template-buttons">
            <button onclick="generateSwitchTemplate('IM')"><i class="fas fa-comment-dots"></i> IM</button>
            <button onclick="generateSwitchTemplate('Ticket')"><i class="fas fa-ticket-alt"></i> Ticket</button>
            <button onclick="generateSwitchTemplate('Break')"><i class="fas fa-coffee"></i> Break</button>
            <button onclick="generateSwitchTemplate('Lunch')"><i class="fas fa-utensils"></i> Lunch</button>
        </div>
        <div class="report-output" id="switchTemplateOutput"></div>
        <button onclick="copySwitchTemplate()" style="margin-top: 20px;"><i class="fas fa-copy"></i> Copy Template</button>
    </div>

    <div class="container" id="agentConfig" style="display: none;">
        <label for="agentConfigNames">Enter Agent Name(s) (one per line):</label>
        <textarea id="agentConfigNames" rows="6" placeholder="e.g. John Doe&#10;Jane Smith&#10;Alex Johnson"></textarea>
        <button onclick="addAgentConfigEntries()">Add Agent(s)</button>

        <div class="results" id="agentConfigResults">
            <!-- Agent configuration entries will be dynamically added here -->
        </div>
    </div>

    <!-- New Backlog Template Tab -->
    <div class="container" id="backlogTemplate" style="display: none;">
        <label for="backlogType">SPS Backlog Update:</label>
        <select id="backlogType" onchange="generateBacklogTemplate()">
            <option value="startDay">Start Day</option>
            <option value="intraday" selected>Intraday</option> <!-- Set Intraday as default selected -->
        </select>

        <div class="backlog-output" id="backlogTemplateOutput">
            <p id="backlogTitle" style="font-weight: bold;"></p> <!-- New element for the dynamic title -->

            <div class="backlog-time-input-group">
                <label for="mnlHourInput">MNL Time:</label>
                <input type="number" id="mnlHourInput" min="0" max="23" value="0" onchange="updateBacklogTimes()">
                <span>:00</span>
                <span id="mnlDateDisplay"></span>
            </div>

            <div class="backlog-time-input-group">
                <label for="usHourInput">US Time:</label>
                <input type="number" id="usHourInput" min="0" max="23" value="0" onchange="updateBacklogTimes()">
                <span>:00</span>
            </div>

            <p id="nextReporting"></p>
            <h3 style="text-align: center;">BACKLOGS MONITORING</h3>
            <p id="backlogAdditionalText" style="margin-top: 20px;"></p> <!-- New element for additional text -->
        </div>
        <button onclick="copyBacklogTemplate()" style="margin-top: 20px;"><i class="fas fa-copy"></i> Copy Backlog Template</button>
    </div>

    <audio id="breakSound" src="audio/notif.mp3" preload="auto"></audio>

    <!-- Toast Notification Container -->
    <div class="toast-container" id="toastContainer"></div>

    <script>
        let generatedScheduleSections = []; // For IM Tasks
        let allAttendanceEntries = [];
        // New object to store the collapse state of attendance sections
        let attendanceSectionCollapseStates = {};
        let allAgentConfigs = []; // New array to store agent configurations

        const shiftOrder = {
            "8PM": 1, "10PM": 2, "10:30PM": 3, "3AM": 4, "5AM": 5
        };

        const attendanceStatuses = [
            "Present", // Added "Present" status
            "Weather/Calamity", "Health", "NCNS", "Personal reason", "For Attrition/AWOL",
            "Running late / Advised halfday", "Unapproved Absence", "Family Event",
            "Childcare/Kincare", "Bereavement", "Family Emergency", "For Validation",
            "Sick leave", "Transportation", "Unauthorized absence"
        ];

        // Options for the new dropdowns in Agent Configuration
        const breakActivityOptions = [
            "First break",
            "Second break",
            "Lunch",
            "Meeting",
            "Coaching",
            "Other"
        ];

        // Templates for the new "Switch Template" tab
        const switchTemplates = {
            "IM": [
                "Transferring you back to IM. Thanks!",
                "Routing you back to IM. Thanks!",
                "Moving you back to IM. Thanks!",
                "Sending you back over to IM. Thanks!",
                "Switching you over to IM. Thanks!"
            ],
            "Ticket": [
                "Transferring you back to ticket. Thanks!",
                "Routing you back to ticket. Thanks!",
                "Moving you back to ticket. Thanks!",
                "Sending you back over to ticket. Thanks!",
                "Switching you over to ticket. Thanks!"
            ],
            "Break": [
                "Transfering you back to IM after break. Thanks!",
                "Switching you to IM after break. Thanks!",
                "Sending you back to IM after break. Thanks!",
                "Routing you back to IM after break. Thanks!",
                "Moving you to IM after break. Thanks!"
            ],
            "Lunch": [
                "Transfering you back to IM after lunch. Thanks!",
                "Switching you to IM after lunch. Thanks!",
                "Sending you back to IM after lunch. Thanks!",
                "Routing you back to IM after lunch. Thanks!",
                "Moving you to IM after lunch. Thanks!"
            ]
        };

        // --- Toast Notification System ---
        function showToast(message, type = 'info') {
            const toastContainer = document.getElementById('toastContainer');
            const toast = document.createElement('div');
            toast.className = `toast ${type}`;
            let icon = '';
            let displayDuration = 3000; // Default duration

            if (type === 'success') {
                icon = '<i class="fas fa-check-circle"></i>';
            } else if (type === 'error') {
                icon = '<i class="fas fa-times-circle"></i>';
            } else if (type === 'info') {
                icon = '<i class="fas fa-info-circle"></i>';
            } else if (type === 'break-alarm') { // Specific handling for break alarms
                icon = '<i class="fas fa-bell"></i>'; // Bell icon for alarms
                displayDuration = 8000; // Longer display for alarms
            }

            toast.innerHTML = `${icon} <span>${message}</span>`;
            toastContainer.appendChild(toast);

            // Trigger reflow to restart animation
            void toast.offsetWidth;

            toast.style.opacity = 1;
            toast.style.transform = 'translateY(0)';

            // Set animation duration dynamically
            toast.style.animation = `toastIn 0.5s forwards, toastOut 0.5s forwards ${displayDuration / 1000}s`;


            setTimeout(() => {
                toast.style.opacity = 0;
                toast.style.transform = 'translateY(20px)';
                toast.addEventListener('transitionend', () => toast.remove(), { once: true });
            }, displayDuration);
        }

        // --- Tab Switching with Animation ---
        function showTab(tabId) {
            const containers = ['tasks', 'report', 'attendance', 'outage', 'intradayTraffic', 'switchTemplate', 'agentConfig', 'backlogTemplate']; // Updated
            containers.forEach(id => {
                const container = document.getElementById(id);
                if (id === tabId) {
                    container.style.display = 'block';
                    setTimeout(() => {
                        container.style.opacity = 1;
                        container.style.transform = 'translateY(0)';
                    }, 50); // Small delay for animation to kick in
                } else {
                    container.style.opacity = 0;
                    container.style.transform = 'translateY(20px)';
                    container.addEventListener('transitionend', function handler() {
                        if (container.style.opacity === '0') {
                            container.style.display = 'none';
                        }
                        container.removeEventListener('transitionend', handler);
                    }, { once: true });
                }
            });

            const tabs = document.querySelectorAll('.tab');
            tabs.forEach(t => t.classList.remove('active'));
            Array.from(tabs).find(t => t.textContent.toLowerCase().includes(
                tabId === 'tasks' ? 'im tasks' :
                tabId === 'report' ? 'report generator' :
                tabId === 'attendance' ? 'attendance report' : // Updated tab name
                tabId === 'outage' ? 'outage report' :
                tabId === 'intradayTraffic' ? 'intraday traffic' :
                tabId === 'switchTemplate' ? 'switch template' :
                tabId === 'agentConfig' ? 'break schedule' :
                'backlog template' // For the new tab name
            )).classList.add('active');

            // If the new tab is selected, generate its content immediately
            if (tabId === 'backlogTemplate') {
                generateBacklogTemplate();
            }
        }

        // Initialize first tab with animation
        document.addEventListener('DOMContentLoaded', () => {
            showTab('tasks'); // Ensure initial tab is shown with animation

            // --- Add Enter key functionality ---

            // IM Tasks Tab
            document.getElementById('taskCount').addEventListener('keypress', function(event) {
                if (event.key === 'Enter') {
                    event.preventDefault(); // Prevent default form submission
                    generateSkills();
                }
            });
            // Also for the textarea, but only if it's not a new line
            document.getElementById('agents').addEventListener('keydown', function(event) {
                if (event.key === 'Enter' && !event.shiftKey) { // Allow Shift+Enter for new line
                    event.preventDefault();
                    generateSkills();
                }
            });

            // Report Generator Tab
            // Listen to the last input field in the grid
            document.getElementById('agentsOnTraining').addEventListener('keypress', function(event) {
                if (event.key === 'Enter') {
                    event.preventDefault();
                    generateReport();
                }
            });
            // Or, listen to any input in the report grid
            document.querySelectorAll('#report .report-input-grid input[type="number"]').forEach(input => {
                input.addEventListener('keypress', function(event) {
                    if (event.key === 'Enter') {
                        event.preventDefault();
                        generateReport();
                    }
                });
            });

            // Attendance Status Tab
            document.getElementById('attendanceNames').addEventListener('keydown', function(event) {
                if (event.key === 'Enter' && !event.shiftKey) { // Allow Shift+Enter for new line
                    event.preventDefault();
                    addAttendanceEntries();
                }
            });

            // Outage Report Tab - Add Enter key functionality for the last input field
            document.getElementById('outageStatus').addEventListener('keypress', function(event) {
                if (event.key === 'Enter') {
                    event.preventDefault();
                    generateOutageReport();
                }
            });

            // Intraday Traffic Tab - Add Enter key functionality for the last input field
            document.getElementById('ticketForecast').addEventListener('keypress', function(event) {
                if (event.key === 'Enter') {
                    event.preventDefault();
                    generateIntradayTrafficReport();
                }
            });

            // Agent Configuration Tab (now Break Schedule)
            document.getElementById('agentConfigNames').addEventListener('keydown', function(event) {
                if (event.key === 'Enter' && !event.shiftKey) { // Allow Shift+Enter for new line
                    event.preventDefault();
                    addAgentConfigEntries();
                }
            });
        });

        // Function to automatically format break time input
        function formatBreakTime(input) {
            let value = input.value.replace(/\D/g, ''); // Remove non-digits
            if (value.length > 2) {
                value = value.substring(0, 2) + ':' + value.substring(2, 4);
            }
            input.value = value;
        }

        function generateSkills() {
            const agentsInput = document.getElementById("agents").value.trim();
            const taskCount = parseInt(document.getElementById("taskCount").value);
            const shiftSchedule = document.getElementById("shiftSchedule").value;
            const resultsDiv = document.getElementById("results");

            if (!agentsInput || isNaN(taskCount) || taskCount < 1) {
                showToast("Please enter valid agent names and task count.", 'error');
                return;
            }

            let agents = agentsInput.split("\n").map(line => {
                const [name, breakTime] = line.split(",").map(item => item.trim());
                return { name, breakTime };
            }).filter(agent => agent.name && agent.breakTime);

            const maxTasksPerAgent = 3;
            const minAgentsRequired = Math.ceil(taskCount / maxTasksPerAgent);

            if (agents.length < minAgentsRequired) {
                showToast(`You need at least ${minAgentsRequired} agents for ${taskCount} tasks.`, 'error');
                return;
            }

            agents.sort((a, b) => b.breakTime.localeCompare(a.breakTime));

            const selectedAgents = agents.slice(0, minAgentsRequired);
            const taskDistribution = {};
            const agentsForExpectations = [];

            for (let i = 0; i < selectedAgents.length; i++) {
                const agent = selectedAgents[i].name;
                taskDistribution[agent] = "will make transfer to IM Queue";
                agentsForExpectations.push(agent);
            }

            const scheduleSection = document.createElement("div");
            scheduleSection.className = "schedule-section";
            const sectionId = `schedule-${Date.now()}`;
            scheduleSection.id = sectionId;
            scheduleSection.setAttribute('data-shift-schedule', shiftSchedule);

            const scheduleHeader = document.createElement("div");
            scheduleHeader.className = "schedule-header";
            scheduleHeader.innerHTML = `
                <span>${shiftSchedule} Shift - IM Assignment & Expectations</span>
                <i class="fas fa-chevron-down"></i>
            `;
            scheduleHeader.onclick = () => toggleCollapse(sectionId);

            const scheduleContent = document.createElement("div");
            scheduleContent.className = "schedule-content";
            scheduleContent.id = `${sectionId}-content`;

            if (agentsForExpectations.length > 0) {
                const expectationsMessageDiv = document.createElement("div");
                expectationsMessageDiv.className = "expectations-message";
                const agentsList = agentsForExpectations.map(agent => `<li>${agent}</li>`).join('');
                expectationsMessageDiv.innerHTML = `<strong>Setting Expectations for ${shiftSchedule} Shift:</strong> The agents listed below will handle IM tasks in sequence if a transfer to the IM queue is needed, with the order arranged according to their break schedules: <ul>${agentsList}</ul>`;
                scheduleContent.appendChild(expectationsMessageDiv);
            }

            const imAssignmentHeader = document.createElement("h3");
            imAssignmentHeader.textContent = "IM Task Assignment";
            imAssignmentHeader.style.color = 'var(--primary-color)';
            imAssignmentHeader.style.marginTop = '20px';
            imAssignmentHeader.style.marginBottom = '15px';
            scheduleContent.appendChild(imAssignmentHeader);

            for (const [agent, message] of Object.entries(taskDistribution)) {
                const div = document.createElement("div");
                div.className = "agent-block";
                div.innerHTML = `<strong>${agent}</strong> <span>- ${message}</span>
                    <button class="done-button" onclick="removeTaskAssignment(this)"><i class="fas fa-check"></i></button>`;
                scheduleContent.appendChild(div);
            }

            scheduleSection.appendChild(scheduleHeader);
            scheduleSection.appendChild(scheduleContent);

            generatedScheduleSections.push(scheduleSection);
            sortAndRenderSchedules();
            showToast("IM Assignment generated successfully!", 'success');
        }

        function sortAndRenderSchedules() {
            const resultsDiv = document.getElementById("results");
            resultsDiv.innerHTML = "";

            generatedScheduleSections.sort((a, b) => {
                const shiftA = a.getAttribute('data-shift-schedule');
                const shiftB = b.getAttribute('data-shift-schedule');
                return (shiftOrder[shiftA] || Infinity) - (shiftOrder[b] || Infinity);
            });

            generatedScheduleSections.forEach(section => {
                resultsDiv.appendChild(section);
            });
        }

        // Re-using toggleCollapse for both IM Tasks and Attendance Status sections
        function toggleCollapse(sectionId) {
            const header = document.getElementById(sectionId).querySelector('.schedule-header');
            const content = document.getElementById(`${sectionId}-content`);

            // For attendance sections, update the global state
            if (sectionId.startsWith('attendance-schedule-')) {
                const shift = sectionId.replace('attendance-schedule-', '');
                // Toggle the state: if it's currently expanded, it will become collapsed (false), and vice-versa
                attendanceSectionCollapseStates[shift] = !content.classList.contains('expanded');
            }

            header.classList.toggle('hidden-content');
            content.classList.toggle('expanded'); // Use 'expanded' class for max-height transition
        }

        function removeTaskAssignment(button) {
            const agentBlock = button.parentElement;
            agentBlock.style.opacity = 0;
            agentBlock.style.transform = 'translateX(-100%)';
            agentBlock.addEventListener('transitionend', () => agentBlock.remove(), { once: true });
            showToast("Task assignment removed.", 'info');
        }

        function generateReport() {
            const imQueueWaiting = parseInt(document.getElementById("imQueueTasks").value);
            const imAgentsWorking = parseInt(document.getElementById("imAgentsWorking").value);
            const ticketQueueWaiting = parseInt(document.getElementById("ticketQueueTasks").value);
            const ticketAgentsWorking = parseInt(document.getElementById("ticketAgentsWorking").value);

            const agentsOnBreak = parseInt(document.getElementById("agentsOnBreak").value);
            const agentsOnLunch = parseInt(document.getElementById("agentsOnLunch").value);
            const agentsOnCoaching = parseInt(document.getElementById("agentsOnCoaching").value);
            const agentsOnMeeting = parseInt(document.getElementById("agentsOnMeeting").value);
            const agentsOnTraining = parseInt(document.getElementById("agentsOnTraining").value);

            const reportOutputDiv = document.getElementById("reportOutput");

            const now = new Date();
            const phOffsetMinutes = 8 * 60; // Philippines is UTC+8
            const localOffsetMinutes = now.getTimezoneOffset(); // Local timezone offset in minutes
            // Calculate PH time by adding PH offset and subtracting local offset
            const phTimeDate = new Date(now.getTime() + (phOffsetMinutes * 60 * 1000) + (localOffsetMinutes * 60 * 1000));

            // Calculate US Central Time (UST) which is UTC-6.
            // PH is UTC+8, so UST is 14 hours behind PH (8 - (-6) = 14)
            let usTimeDate = new Date(phTimeDate.getTime() - (14 * 60 * 60 * 1000));

            // Subtract 1 hour from US Central Time
            usTimeDate.setHours(usTimeDate.getHours() - 1);

            const usHours = String(usTimeDate.getHours()).padStart(2, '0');
            const formattedUsTime = `${usHours}:00`;

            const options = { month: 'long', day: 'numeric', year: 'numeric' };
            const formattedDate = usTimeDate.toLocaleDateString('en-US', options); // Date should be based on US time

            // Make the header bold
            let reportHeader = `<strong>As of ${formattedUsTime} (UST) ${formattedDate}.\nUS-BDEE-SPS</strong>\n\n`;

            const imAgentText = imAgentsWorking === 1 ? "agent" : "agents";
            const ticketAgentText = ticketAgentsWorking === 1 ? "agent" : "agents";

            let report = reportHeader;
            report += `IM Queue: ${imQueueWaiting} waiting with ${imAgentsWorking} ${imAgentText} working.\n`;
            report += `TK Queue: ${ticketQueueWaiting} waiting with ${ticketAgentsWorking} ${ticketAgentText} working.\n\n`;

            let activityPhrases = [];

            if (agentsOnBreak > 0) {
                activityPhrases.push(`${agentsOnBreak} ${agentsOnBreak === 1 ? 'agent' : 'agents'} on break`);
            }
            if (agentsOnLunch > 0) {
                activityPhrases.push(`${agentsOnLunch} ${agentsOnLunch === 1 ? 'agent' : 'agents'} on lunch`);
            }
            if (agentsOnCoaching > 0) {
                activityPhrases.push(`${agentsOnCoaching} ${agentsOnCoaching === 1 ? 'agent' : 'agents'} in coaching`);
            }
            if (agentsOnMeeting > 0) {
                activityPhrases.push(`${agentsOnMeeting} ${agentsOnMeeting === 1 ? 'agent' : 'agents'} in a meeting`);
            }
            if (agentsOnTraining > 0) {
                activityPhrases.push(`${agentsOnTraining} ${agentsOnTraining === 1 ? 'agent' : 'agents'} attending training`);
            }

            if (activityPhrases.length > 0) {
                let activitySentence = "Right now, we have ";

                if (activityPhrases.length === 1) {
                    activitySentence += `${activityPhrases[0]}.`;
                } else if (activityPhrases.length === 2) {
                    activitySentence += `${activityPhrases[0]} and ${activityPhrases[1]}.`;
                } else {
                    const lastPhrase = activityPhrases.pop();
                    activitySentence += `${activityPhrases.join(', ')}, and ${lastPhrase}.`;
                }
                report += `${activitySentence}\n`;
            }

            reportOutputDiv.innerHTML = report; // Use innerHTML to render bold tag
            showToast("Report generated successfully!", 'success');
        }

        // New function to copy the report
        function copyReport() {
            const reportText = document.getElementById("reportOutput").innerText; // Use innerText to get plain text
            if (reportText.trim() === "") {
                showToast("No report to copy. Generate a report first.", 'info');
                return;
            }

            navigator.clipboard.writeText(reportText)
                .then(() => {
                    showToast("Report copied to clipboard!", 'success');
                })
                .catch(err => {
                    console.error('Failed to copy report: ', err);
                    showToast("Failed to copy report. Please try again.", 'error');
                });
        }

        // --- Attendance Status Functions ---
        function addAttendanceEntries() {
            const attendanceNamesInput = document.getElementById("attendanceNames").value.trim();
            const shiftSchedule = document.getElementById("attendanceShiftSchedule").value;

            if (!attendanceNamesInput) {
                showToast("Please enter agent name(s).", 'error');
                return;
            }

            const names = attendanceNamesInput.split("\n").map(name => name.trim()).filter(name => name);

            if (names.length === 0) {
                showToast("No valid agent names entered.", 'error');
                return;
            }

            names.forEach(agentName => {
                const entryId = `attendance-entry-${Date.now()}-${Math.random().toString(36).substr(2, 9)}`;
                allAttendanceEntries.push({
                    id: entryId,
                    name: agentName,
                    status: attendanceStatuses[0], // Default to first status ("Present")
                    shift: shiftSchedule
                });
            });

            sortAndRenderAttendanceSections();
            showToast("Attendance entries added.", 'success');
            document.getElementById("attendanceNames").value = ''; // Clear textarea after adding
        }

        function updateAttendanceStatus(entryId, newStatus) {
            const entryIndex = allAttendanceEntries.findIndex(entry => entry.id === entryId);
            if (entryIndex !== -1) {
                allAttendanceEntries[entryIndex].status = newStatus;
                showToast(`Status for ${allAttendanceEntries[entryIndex].name} updated to ${newStatus}.`, 'info');
                sortAndRenderAttendanceSections(); // Re-sort to reflect status change in order
            }
        }

        function deleteAttendance(entryId) {
            const entryIndex = allAttendanceEntries.findIndex(entry => entry.id === entryId);
            if (entryIndex !== -1) {
                const agentName = allAttendanceEntries[entryIndex].name;
                allAttendanceEntries.splice(entryIndex, 1); // Remove from array
                showToast(`Attendance entry for ${agentName} deleted.`, 'error');
                sortAndRenderAttendanceSections(); // Re-render to ensure correct order
            }
        }

        function sortAndRenderAttendanceSections() {
            const attendanceResultsDiv = document.getElementById("attendanceResults");

            // 1. Capture current collapse states before clearing
            const currentSections = attendanceResultsDiv.querySelectorAll('.schedule-section');
            currentSections.forEach(section => {
                const shift = section.getAttribute('data-shift-schedule');
                const content = section.querySelector('.schedule-content');
                attendanceSectionCollapseStates[shift] = content.classList.contains('expanded');
            });

            attendanceResultsDiv.innerHTML = ''; // Clear all existing entries

            // Group entries by shift
            const groupedByShift = allAttendanceEntries.reduce((acc, entry) => {
                if (!acc[entry.shift]) {
                    acc[entry.shift] = [];
                }
                acc[entry.shift].push(entry);
                return acc;
            }, {});

            // Sort shifts based on predefined order
            const sortedShifts = Object.keys(groupedByShift).sort((a, b) => {
                return (shiftOrder[a] || Infinity) - (shiftOrder[b] || Infinity);
            });

            sortedShifts.forEach(shift => {
                const shiftEntries = groupedByShift[shift];

                // Sort entries within each shift by status and then by name
                shiftEntries.sort((a, b) => {
                    // Sort by status first
                    const statusAIndex = attendanceStatuses.indexOf(a.status);
                    const statusBIndex = attendanceStatuses.indexOf(b.status);
                    if (statusAIndex < statusBIndex) return -1;
                    if (statusAIndex > statusBIndex) return 1;

                    // Then by name
                    return a.name.localeCompare(b.name);
                });

                const sectionId = `attendance-schedule-${shift}`;
                const scheduleSection = document.createElement("div");
                scheduleSection.className = "schedule-section";
                scheduleSection.id = sectionId;
                scheduleSection.setAttribute('data-shift-schedule', shift);

                const scheduleHeader = document.createElement("div");
                scheduleHeader.className = "schedule-header";
                scheduleHeader.innerHTML = `
                    <span>${shift} Shift Attendance</span>
                    <i class="fas fa-chevron-down"></i>
                `;
                scheduleHeader.onclick = () => toggleCollapse(sectionId);

                const scheduleContent = document.createElement("div");
                scheduleContent.className = "schedule-content";
                scheduleContent.id = `${sectionId}-content`;

                shiftEntries.forEach(entryData => {
                    const div = document.createElement("div");
                    div.className = "agent-block attendance-entry";
                    div.id = entryData.id; // Ensure the ID is set for direct manipulation if needed
                    div.setAttribute('data-agent-name', entryData.name);
                    div.setAttribute('data-status', entryData.status);
                    div.setAttribute('data-shift', entryData.shift);

                    let statusOptionsHtml = attendanceStatuses.map(status =>
                        `<option value="${status}" ${status === entryData.status ? 'selected' : ''}>${status}</option>`
                    ).join('');

                    div.innerHTML = `
                        <strong>${entryData.name}</strong>
                        <select onchange="updateAttendanceStatus('${entryData.id}', this.value)">
                            ${statusOptionsHtml}
                        </select>
                        <div class="actions">
                            <button class="delete-button" onclick="deleteAttendance('${entryData.id}')"><i class="fas fa-trash-alt"></i></button>
                        </div>
                    `;
                    scheduleContent.appendChild(div);
                });

                scheduleSection.appendChild(scheduleHeader);
                scheduleSection.appendChild(scheduleContent);
                attendanceResultsDiv.appendChild(scheduleSection);

                // 2. Apply stored collapse states after rendering
                // Check if the state was explicitly true (expanded)
                if (attendanceSectionCollapseStates[shift] === true) {
                    scheduleHeader.classList.add('hidden-content'); // Add class to header to rotate icon
                    scheduleContent.classList.add('expanded'); // Expand content
                } else if (attendanceSectionCollapseStates[shift] === false) {
                    // If it was explicitly false (collapsed), ensure it stays collapsed
                    scheduleHeader.classList.remove('hidden-content');
                    scheduleContent.classList.remove('expanded');
                }
                // If state was undefined (first render), it remains collapsed by default CSS
            });
        }

        function generateAttendanceReport() {
            if (allAttendanceEntries.length === 0) {
                showToast("No attendance entries to report.", 'info');
                document.getElementById('attendanceReportOutput').innerHTML = "";
                return;
            }

            const reportHtmlParts = [];
            const shiftHeadcounts = {};
            const absentAgents = {};
            const presentAgents = {}; // To store present agents for the report

            // Group by shift and count headcounts, identify absents and presents
            allAttendanceEntries.forEach(entry => {
                shiftHeadcounts[entry.shift] = (shiftHeadcounts[entry.shift] || 0) + 1;
                if (entry.status !== "Present") {
                    if (!absentAgents[entry.shift]) {
                        absentAgents[entry.shift] = [];
                    }
                    absentAgents[entry.shift].push({ name: entry.name, reason: entry.status });
                } else {
                    if (!presentAgents[entry.shift]) {
                        presentAgents[entry.shift] = [];
                    }
                    presentAgents[entry.shift].push(entry.name);
                }
            });

            // Sort shifts for consistent reporting
            const sortedShifts = Object.keys(shiftHeadcounts).sort((a, b) => {
                return (shiftOrder[a] || Infinity) - (shiftOrder[b] || Infinity);
            });

            reportHtmlParts.push("<h3>Attendance Report:</h3>");
            reportHtmlParts.push("<ul>"); // Start main unordered list for shifts

            sortedShifts.forEach(shift => {
                const totalHeadcount = shiftHeadcounts[shift];
                const presentCount = presentAgents[shift] ? presentAgents[shift].length : 0;
                const absentCount = absentAgents[shift] ? absentAgents[shift].length : 0;

                reportHtmlParts.push(`<li><h4>${shift} Shift:</h4>`);
                reportHtmlParts.push(`  <ul>`); // Sub-list for present/absent counts
                reportHtmlParts.push(`    <li><strong>Present:</strong> ${presentCount} out of ${totalHeadcount} headcount.</li>`);

                if (presentAgents[shift] && presentAgents[shift].length > 0) {
                    reportHtmlParts.push(`    <ul>`); // Sub-sub-list for present agents
                    presentAgents[shift].sort().forEach(agentName => {
                        reportHtmlParts.push(`      <li>${agentName}</li>`);
                    });
                    reportHtmlParts.push(`    </ul>`);
                }

                if (absentAgents[shift] && absentAgents[shift].length > 0) {
                    reportHtmlParts.push(`    <li><strong>Absent:</strong> ${absentCount} agent(s).</li>`);
                    reportHtmlParts.push(`    <ul>`); // Sub-sub-list for absent agents
                    absentAgents[shift].sort((a, b) => a.name.localeCompare(b.name)).forEach(agent => {
                        reportHtmlParts.push(`      <li>${agent.name} (${agent.reason})</li>`);
                    });
                    reportHtmlParts.push(`    </ul>`);
                }
                reportHtmlParts.push(`  </ul>`); // End sub-list for present/absent counts
                reportHtmlParts.push(`</li>`); // End main list item for the shift
            });

            reportHtmlParts.push("</ul>"); // End main unordered list

            document.getElementById('attendanceReportOutput').innerHTML = reportHtmlParts.join('\n');
            showToast("Attendance Report generated!", 'success');
        }

        function copyAttendanceReport() {
            const reportOutputDiv = document.getElementById("attendanceReportOutput");
            // Create a temporary textarea to hold the text content
            const tempTextArea = document.createElement('textarea');
            // Convert the HTML content to plain text for copying
            tempTextArea.innerHTML = reportOutputDiv.innerHTML;
            document.body.appendChild(tempTextArea);
            tempTextArea.select();
            document.execCommand('copy');
            document.body.removeChild(tempTextArea);
            showToast("Attendance Report copied to clipboard!", 'success');
        }

        // --- Outage Report Functions ---
        function generateOutageReport() {
            const account = document.getElementById('outageAccount').value;
            const startTime = document.getElementById('outageStartTime').value;
            const affected = document.getElementById('outageAffected').value.trim();
            const side = document.getElementById('outageSide').value;
            const assistCustomer = document.getElementById('outageAssistCustomer').value;
            const b2pAffecting = document.getElementById('outageB2PAffecting').value;
            const description = document.getElementById('outageDescription').value.trim();
            const status = document.getElementById('outageStatus').value;

            if (!account || !startTime || !affected || !side || !assistCustomer || !b2pAffecting || !description || !status) {
                showToast("Please fill in all fields for the Outage Report.", 'error');
                return;
            }

            // Format the start time for readability
            let formattedStartTime = '';
            try {
                const dateObj = new Date(startTime);
                formattedStartTime = dateObj.toLocaleString('en-US', {
                    year: 'numeric', month: 'long', day: 'numeric',
                    hour: '2-digit', minute: '2-digit', second: '2-digit',
                    hour12: true
                });
            } catch (e) {
                formattedStartTime = startTime; // Fallback if date parsing fails
            }

            const reportText = `
Account: ${account}
Outage start date and time: ${formattedStartTime}
Affected: ${affected}
Client side/CNX side: ${side}
Can we still assist customer: ${assistCustomer}
B2P affecting, yes or no: ${b2pAffecting}
Short description of the outage: ${description}
Status: ${status}
            `.trim();

            document.getElementById('outageReportOutput').innerText = reportText;
            showToast("Outage Report generated successfully!", 'success');
        }

        function copyOutageReport() {
            const reportText = document.getElementById("outageReportOutput").innerText;
            if (reportText.trim() === "") {
                showToast("No Outage Report to copy. Generate a report first.", 'info');
                return;
            }

            navigator.clipboard.writeText(reportText)
                .then(() => {
                    showToast("Outage Report copied to clipboard!", 'success');
                })
                .catch(err => {
                    console.error('Failed to copy outage report: ', err);
                    showToast("Failed to copy outage report. Please try again.", 'error');
                });
        }

        // --- New Backlog Report Functions ---
        function generateUSTBacklog() {
            const reportOutputDiv = document.getElementById("reportOutput");
            const now = new Date();

            // Calculate US Central Time (UST) which is UTC-6.
            // Get UTC time, then add/subtract offset for UST
            const utc = now.getTime() + (now.getTimezoneOffset() * 60000);
            let ustTimeDate = new Date(utc + (-6 * 3600000)); // UTC-6

            // Subtract 1 hour from US Central Time
            ustTimeDate.setHours(ustTimeDate.getHours() - 1);

            const usHours = String(ustTimeDate.getHours()).padStart(2, '0');
            const formattedUstTime = `${usHours}:00`; // Changed to formattedUstTime for consistency

            const options = { month: 'long', day: 'numeric', year: 'numeric' };
            const formattedDate = ustTimeDate.toLocaleDateString('en-US', options);

            const report = `Backlogs as of ${formattedUstTime} (UST) | ${formattedDate}.

We have already advised the agents to prioritize open, assigned, and reviewing pending and on-hold tickets that have been aging for more than five days.`;

            reportOutputDiv.innerText = report;
            showToast("UST Backlog Report generated!", 'success');
        }

        function generatePHBacklog() {
            const reportOutputDiv = document.getElementById("reportOutput");
            const now = new Date();

            // Calculate Philippine Time (PH) which is UTC+8.
            // Get UTC time, then add/subtract offset for PH
            const utc = now.getTime() + (now.getTimezoneOffset() * 60000);
            const phTimeDate = new Date(utc + (8 * 3600000)); // UTC+8

            const phHours = phTimeDate.getHours();
            const ampm = phHours >= 12 ? 'PM' : 'AM';
            const displayHour = phHours % 12 === 0 ? 12 : phHours % 12; // Convert 0 to 12 for 12 AM/PM
            const formattedPhHour = `${displayHour}${ampm}`;

            const options = { month: 'long', day: 'numeric', year: 'numeric' };
            const formattedDate = phTimeDate.toLocaleDateString('en-US', options);

            const report = `Backlogs as of ${formattedPhHour} | ${formattedDate}.`;

            reportOutputDiv.innerText = report;
            showToast("PH Backlog Report generated!", 'success');
        }

        function generateReminder() {
            const reportOutputDiv = document.getElementById("reportOutput");
            const reminderText = `Hi Team,

Kindly check all Pending, Onhold, Assigned, and Open tickets. Please prioritize those that have been Pending for more than 5 days.

PENDING

OPEN

ONHOLD

ASSIGNED`;

            reportOutputDiv.innerText = reminderText;
            showToast("Reminder generated!", 'success');
        }

        // New function for Handling CO
        function generateHandlingCO() {
            const reportOutputDiv = document.getElementById("reportOutput");
            const handlingCOText = `Please check your current handling and prioritize your tasks if youre on the list below. Focus especially on those with higher handling times or pending tasks.`;

            reportOutputDiv.innerText = handlingCOText;
            showToast("Handling CO message generated!", 'success');
        }

        // --- Intraday Traffic Report Functions ---
        function generateIntradayTrafficReport() {
            const imInbound = parseInt(document.getElementById("imInbound").value);
            const imForecast = parseInt(document.getElementById("imForecast").value);
            const ticketInbound = parseInt(document.getElementById("ticketInbound").value);
            const ticketForecast = parseInt(document.getElementById("ticketForecast").value);
            const reportOutputDiv = document.getElementById("intradayTrafficReportOutput");

            if (isNaN(imInbound) || isNaN(imForecast) || isNaN(ticketInbound) || isNaN(ticketForecast)) {
                showToast("Please enter valid numbers for all fields.", 'error');
                return;
            }

            const now = new Date();
            // Subtract one day from the current date
            now.setDate(now.getDate() - 1);
            const options = { month: 'long', day: 'numeric', year: 'numeric' };
            const formattedDate = now.toLocaleDateString('en-US', options);

            let imPercentage = 0;
            let imComparisonText = "";
            if (imForecast > 0) {
                imPercentage = ((imInbound / imForecast) * 100).toFixed(0);
                if (imInbound > imForecast) {
                    imComparisonText = `- Today, we've seen ${imInbound} inbound IMs, which is well over ${Math.round(imInbound / imForecast)} times our forecast of ${imForecast}.
 - This ${imPercentage}% over-delivery is putting significant strain on our IM team, causing agents to operate at full capacity and potentially leading to longer wait times for our customers.`;
                } else if (imInbound < imForecast) {
                    imComparisonText = `- Today, we've seen ${imInbound} inbound IMs, which is below our forecast of ${imForecast}.
 - This ${imPercentage}% delivery means we currently have capacity to handle more volume.`;
                } else {
                    imComparisonText = `- Today, we've seen ${imInbound} inbound IMs, which is exactly our forecast of ${imForecast}.
 - This ${imPercentage}% delivery indicates stable volume.`;
                }
            } else {
                imComparisonText = `- Today, we've seen ${imInbound} inbound IMs, with no forecast provided.`;
            }

            let ticketPercentage = 0;
            let ticketComparisonText = "";
            if (ticketForecast > 0) {
                ticketPercentage = ((ticketInbound / ticketForecast) * 100).toFixed(0);
                if (ticketInbound > ticketForecast) {
                    ticketComparisonText = `- Ticket volume is also up, with ${ticketInbound} inbound tickets, compared to a forecast of ${ticketForecast}.
 - That's a ${ticketPercentage}% increase, leading to the backlog we're currently addressing.
 - Because ticket handling takes more time per case, even this relatively smaller volume spike has a significant impact on the overall workload.`;
                } else if (ticketInbound < ticketForecast) {
                    ticketComparisonText = `- Ticket volume is also down, with ${ticketInbound} inbound tickets, compared to a forecast of ${ticketForecast}.
 - That's a ${ticketPercentage}% delivery, indicating lower than expected volume.`;
                } else {
                    ticketComparisonText = `- Ticket volume is stable, with ${ticketInbound} inbound tickets, exactly matching our forecast of ${ticketForecast}.
 - That's a ${ticketPercentage}% delivery, indicating stable volume.`;
                }
            } else {
                ticketComparisonText = `- Ticket volume is ${ticketInbound} inbound tickets, with no forecast provided.`;
            }

            const report = `Hi @All!

Heres a quick update on our intraday traffic as of ${formattedDate}:

IM Queue
${imComparisonText}

Ticket Queue
${ticketComparisonText}

What Were Doing
 - Our priority remains keeping the IM queue as responsive as possible. Were monitoring closely and adjusting coverage in real time.
 - For tickets, we are prioritizing tickets assigned for over 5 days and focusing on clearing those to reduce backlog impact.`;

            reportOutputDiv.innerText = report;
            showToast("Intraday Traffic Report generated!", 'success');
        }

        function copyIntradayTrafficReport() {
            const reportText = document.getElementById("intradayTrafficReportOutput").innerText;
            if (reportText.trim() === "") {
                showToast("No Intraday Traffic Report to copy. Generate a report first.", 'info');
                return;
            }

            navigator.clipboard.writeText(reportText)
                .then(() => {
                    showToast("Intraday Traffic Report copied to clipboard!", 'success');
                })
                .catch(err => {
                    console.error('Failed to copy intraday traffic report: ', err);
                    showToast("Failed to copy intraday traffic report. Please try again.", 'error');
                });
        }

        // --- Switch Template Functions ---
        function generateSwitchTemplate(templateType) {
            const templates = switchTemplates[templateType];
            if (!templates || templates.length === 0) {
                document.getElementById('switchTemplateOutput').innerText = "No templates available for this type.";
                showToast("No templates available.", 'info');
                return;
            }

            // Select a random template from the array
            const randomIndex = Math.floor(Math.random() * templates.length);
            const selectedTemplate = templates[randomIndex];

            document.getElementById('switchTemplateOutput').innerText = selectedTemplate;
            showToast(`Generated ${templateType} template!`, 'success');
        }

        function copySwitchTemplate() {
            const templateText = document.getElementById("switchTemplateOutput").innerText;
            if (templateText.trim() === "") {
                showToast("No template to copy. Generate a template first.", 'info');
                return;
            }

            navigator.clipboard.writeText(templateText)
                .then(() => {
                    showToast("Template copied to clipboard!", 'success');
                })
                .catch(err => {
                    console.error('Failed to copy template: ', err);
                    showToast("Failed to copy template. Please try again.", 'error');
                });
        }

        // --- Agent Configuration Functions ---
        function addAgentConfigEntries() {
            const agentNamesInput = document.getElementById('agentConfigNames').value.trim();
            if (!agentNamesInput) {
                showToast("Please enter agent name(s).", 'error');
                return;
            }

            const names = agentNamesInput.split("\n").map(name => name.trim()).filter(name => name);

            if (names.length === 0) {
                showToast("No valid agent names entered.", 'error');
                return;
            }

            names.forEach(agentName => {
                const existingAgent = allAgentConfigs.find(config => config.name === agentName);
                if (existingAgent) {
                    showToast(`Agent "${agentName}" already exists.`, 'info');
                    return;
                }

                const entryId = `agent-config-${Date.now()}-${Math.random().toString(36).substr(2, 9)}`;
                allAgentConfigs.push({
                    id: entryId,
                    name: agentName,
                    breakSlots: [] // Initialize with no break slots
                });
            });

            renderAgentConfigs();
            document.getElementById('agentConfigNames').value = ''; // Clear input
            showToast("Agent(s) added to configuration.", 'success');
        }

        function addBreakSlot(agentId) {
            const agentIndex = allAgentConfigs.findIndex(config => config.id === agentId);
            if (agentIndex !== -1) {
                if (allAgentConfigs[agentIndex].breakSlots.length < 6) {
                    allAgentConfigs[agentIndex].breakSlots.push({
                        type: breakActivityOptions[0], // Default to first option
                        time: ''
                    });
                    renderAgentConfigs(); // Re-render to show new slot
                    showToast("Break/Activity slot added.", 'info');
                } else {
                    showToast("Maximum 6 break/activity slots per agent.", 'info');
                }
            }
        }

        function updateBreakSlot(agentId, slotIndex, field, value) {
            const agentIndex = allAgentConfigs.findIndex(config => config.id === agentId);
            if (agentIndex !== -1 && allAgentConfigs[agentIndex].breakSlots[slotIndex]) {
                allAgentConfigs[agentIndex].breakSlots[slotIndex][field] = value;
                // Re-set alarm if time is updated
                if (field === 'time') {
                    const agentName = allAgentConfigs[agentIndex].name;
                    const slot = allAgentConfigs[agentIndex].breakSlots[slotIndex];
                    // Generate a unique ID for this specific slot for the alarm
                    const slotAlarmId = `${agentId}-slot-container-${slotIndex}`; // Use the container ID
                    setBreakAlarmAgentConfig(agentName, slot.type, slot.time, slotAlarmId);
                }
                showToast(`Break/Activity updated for ${allAgentConfigs[agentIndex].name}.`, 'info');
            }
        }

        function removeBreakSlot(agentId, slotIndex) {
            const agentIndex = allAgentConfigs.findIndex(config => config.id === agentId);
            if (agentIndex !== -1 && allAgentConfigs[agentIndex].breakSlots[slotIndex]) {
                allAgentConfigs[agentIndex].breakSlots.splice(slotIndex, 1);
                renderAgentConfigs(); // Re-render to remove slot
                showToast("Break/Activity slot removed.", 'info');
            }
        }

        function deleteAgentConfig(entryId) {
            const entryIndex = allAgentConfigs.findIndex(entry => entry.id === entryId);
            if (entryIndex !== -1) {
                const agentName = allAgentConfigs[entryIndex].name;
                allAgentConfigs.splice(entryIndex, 1);
                renderAgentConfigs();
                showToast(`Agent "${agentName}" removed from configuration.`, 'error');
            }
        }

        function renderAgentConfigs() {
            const agentConfigResultsDiv = document.getElementById('agentConfigResults');
            agentConfigResultsDiv.innerHTML = ''; // Clear existing entries

            allAgentConfigs.sort((a, b) => a.name.localeCompare(b.name)); // Sort alphabetically by name

            allAgentConfigs.forEach(config => {
                const div = document.createElement('div');
                div.className = 'agent-config-entry';
                div.id = config.id;

                let breakSlotsHtml = config.breakSlots.map((slot, index) => {
                    let optionsHtml = breakActivityOptions.map(option =>
                        `<option value="${option}" ${option === slot.type ? 'selected' : ''}>${option}</option>`
                    ).join('');
                    // Generate a unique ID for this specific slot for the alarm
                    const slotContainerId = `${config.id}-slot-container-${index}`;
                    // Set alarm for each slot when rendered
                    if (slot.time) { // Only set alarm if time is provided
                        setBreakAlarmAgentConfig(config.name, slot.type, slot.time, slotContainerId);
                    }
                    return `
                        <div class="break-slot-container" id="${slotContainerId}">
                            <select onchange="updateBreakSlot('${config.id}', ${index}, 'type', this.value)">
                                ${optionsHtml}
                            </select>
                            <input type="text" placeholder="HH:MM" value="${slot.time}"
                                oninput="formatBreakTime(this); updateBreakSlot('${config.id}', ${index}, 'time', this.value)"
                                pattern="([01]?[0-9]|2[0-3]):[0-5][0-9]" maxlength="5" />
                            <button class="remove-slot-button" onclick="removeBreakSlot('${config.id}', ${index})"><i class="fas fa-minus-circle"></i></button>
                        </div>
                    `;
                }).join('');

                div.innerHTML = `
                    <strong>${config.name}</strong>
                    ${breakSlotsHtml}
                    <button class="add-slot-button" onclick="addBreakSlot('${config.id}')"><i class="fas fa-plus-circle"></i> Add Break/Activity Slot</button>
                    <div class="actions">
                        <button class="delete-button" onclick="deleteAgentConfig('${config.id}')"><i class="fas fa-trash-alt"></i> Delete Agent</button>
                    </div>
                `;
                agentConfigResultsDiv.appendChild(div);
            });
        }

        // New function for Agent Configuration break alarms
        function setBreakAlarmAgentConfig(agentName, breakType, breakTime, slotContainerId) {
            // Clear any existing alarms for this slot to prevent duplicates
            clearTimeout(window[`alarmTimeout_${slotContainerId}`]);

            const now = new Date();
            const breakDate = new Date();
            const [hours, minutes] = breakTime.split(':');

            if (!hours || !minutes) { // If time is not valid, don't set alarm
                return;
            }

            breakDate.setHours(parseInt(hours), parseInt(minutes), 0, 0);

            // Adjust breakDate to be 20 minutes *before* the actual break time
            breakDate.setMinutes(breakDate.getMinutes() - 20);

            // If the adjusted break time is in the past, assume it's for the next day
            // This logic needs to be careful: if current time is 10:00 and break is 10:15 (alarm 09:55),
            // and we set it for next day, it will be 09:55 next day.
            // We only want to set for next day if the *adjusted* time is already past *today*.
            if (breakDate < now) {
                breakDate.setDate(breakDate.getDate() + 1);
            }

            const timeUntilAlarm = breakDate - now;

            // Function to format time for display (e.g., 14:30 -> 02:30 PM)
            const formatDisplayTime = (time24hr) => {
                const [h, m] = time24hr.split(':');
                let hours = parseInt(h);
                const minutes = parseInt(m);
                const ampm = hours >= 12 ? 'PM' : 'AM';
                hours = hours % 12;
                hours = hours ? hours : 12; // the hour '0' should be '12'
                const strMinutes = minutes < 10 ? '0' + minutes : minutes;
                return `${hours}:${strMinutes} ${ampm}`;
            };

            if (timeUntilAlarm > 0) {
                window[`alarmTimeout_${slotContainerId}`] = setTimeout(() => {
                    const breakSound = document.getElementById("breakSound");
                    if (breakSound) {
                        breakSound.play().catch(e => console.error("Error playing sound:", e));
                    }
                    // Use 'break-alarm' type for emphasized notification
                    showToast(`${agentName}'s ${breakType.toLowerCase()} is in 20 minutes! (${formatDisplayTime(breakTime)})`, 'break-alarm');

                    // Visually mark the slot as "upcoming" or "alerted"
                    const slotContainer = document.getElementById(slotContainerId);
                    if (slotContainer) {
                        slotContainer.style.borderLeftColor = 'orange'; // Highlight with orange
                        slotContainer.style.boxShadow = '0 5px 15px rgba(255, 165, 0, 0.5)';
                    }

                    // Set another timeout for the actual break time to mark it as completed
                    const actualBreakTime = new Date();
                    actualBreakTime.setHours(parseInt(hours), parseInt(minutes), 0, 0);
                    if (actualBreakTime < now) { // If actual break time is already past today
                        actualBreakTime.setDate(actualBreakTime.getDate() + 1);
                    }
                    const timeUntilActualBreak = actualBreakTime - new Date(); // Recalculate from current time

                    if (timeUntilActualBreak > 0) {
                        setTimeout(() => {
                            const slotContainer = document.getElementById(slotContainerId);
                            if (slotContainer) {
                                slotContainer.style.opacity = '0.6';
                                slotContainer.style.borderLeftColor = '#607d8b'; // Dimmed color
                                slotContainer.style.boxShadow = '0 2px 8px rgba(0,0,0,0.2)';
                                // Hide select and input, and remove button
                                slotContainer.querySelectorAll('select, input, button').forEach(el => {
                                    el.style.display = 'none';
                                });
                                // Add a text element to show the completed break
                                const completedText = document.createElement('span');
                                completedText.textContent = `${breakType} at ${formatDisplayTime(breakTime)} - COMPLETED`;
                                completedText.style.color = 'var(--text-color)';
                                completedText.style.fontWeight = 'bold';
                                slotContainer.prepend(completedText); // Add at the beginning
                            }
                        }, timeUntilActualBreak);
                    } else {
                         // If actual break time is already past, mark as completed immediately
                        const slotContainer = document.getElementById(slotContainerId);
                        if (slotContainer) {
                            slotContainer.style.opacity = '0.6';
                            slotContainer.style.borderLeftColor = '#607d8b';
                            slotContainer.style.boxShadow = '0 2px 8px rgba(0,0,0,0.2)';
                            slotContainer.querySelectorAll('select, input, button').forEach(el => {
                                el.style.display = 'none';
                            });
                            const completedText = document.createElement('span');
                            completedText.textContent = `${breakType} at ${formatDisplayTime(breakTime)} - COMPLETED`;
                            completedText.style.color = 'var(--text-color)';
                            completedText.style.fontWeight = 'bold';
                            slotContainer.prepend(completedText);
                        }
                    }

                }, timeUntilAlarm);
            } else {
                // If the 20-min-before alarm time is already past, mark as completed immediately
                const slotContainer = document.getElementById(slotContainerId);
                if (slotContainer) {
                    slotContainer.style.opacity = '0.6';
                    slotContainer.style.borderLeftColor = '#607d8b';
                    slotContainer.style.boxShadow = '0 2px 8px rgba(0,0,0,0.2)';
                    slotContainer.querySelectorAll('select, input, button').forEach(el => {
                        el.style.display = 'none';
                    });
                    const completedText = document.createElement('span');
                    completedText.textContent = `${breakType} at ${formatDisplayTime(breakTime)} - COMPLETED`;
                    completedText.style.color = 'var(--text-color)';
                    completedText.style.fontWeight = 'bold';
                    slotContainer.prepend(completedText);
                }
            }
        }

        // --- Backlog Template Functions ---
        function generateBacklogTemplate() {
            const backlogType = document.getElementById('backlogType').value;
            const backlogTitleElem = document.getElementById('backlogTitle');
            const mnlHourInput = document.getElementById('mnlHourInput');
            const mnlDateDisplay = document.getElementById('mnlDateDisplay');
            const usHourInput = document.getElementById('usHourInput');
            const nextReportingElem = document.getElementById('nextReporting');
            const backlogAdditionalTextElem = document.getElementById('backlogAdditionalText'); // New element

            // Set the dynamic title based on selection
            if (backlogType === 'startDay') {
                backlogTitleElem.textContent = "SPS Backlog update (Start Day)";
                backlogAdditionalTextElem.textContent = ""; // Clear additional text for Start Day
            } else {
                backlogTitleElem.textContent = "SPS Backlog update (Intraday)";
                backlogAdditionalTextElem.textContent = `
Could you please help me report this image in a polite and natural tone? I want to explain that theres a high volume of messages in IM, so were still balancing the distribution to make sure both queues work efficiently. Also, that the 3-5 day unassigned and assigned tickets are still being prioritized. Thank you!
                `; // Set additional text for Intraday
            }

            const now = new Date();

            // MNL Time (UTC+8)
            const mnlOptions = {
                hour: '2-digit',
                hour12: false,
                timeZone: 'Asia/Manila',
                month: 'long',
                day: 'numeric',
                year: 'numeric'
            };
            const mnlFormatter = new Intl.DateTimeFormat('en-US', mnlOptions);
            const mnlParts = mnlFormatter.formatToParts(now);
            const mnlHour = parseInt(mnlParts.find(p => p.type === 'hour').value);
            const mnlMonth = mnlParts.find(p => p.type === 'month').value;
            const mnlDay = mnlParts.find(p => p.type === 'day').value;
            const mnlYear = mnlParts.find(p => p.type === 'year').value;

            mnlHourInput.value = mnlHour;
            mnlDateDisplay.textContent = `- ${mnlMonth} ${mnlDay}, ${mnlYear}`;

            // US Time (Central Time - UTC-6), less 2 hours (updated from 1 hour)
            const usOptions = {
                hour: '2-digit',
                hour12: false,
                timeZone: 'America/Chicago' // Central Time
            };
            const usFormatter = new Intl.DateTimeFormat('en-US', usOptions);
            const usParts = usFormatter.formatToParts(now);
            let usHour = parseInt(usParts.find(p => p.type === 'hour').value);

            usHour = (usHour - 2 + 24) % 24; // Subtract 2 hours, handle wrap-around for 00 to 23

            usHourInput.value = usHour;

            // Next Reporting Time (hourly, on the hour)
            let nextReportingHour = (parseInt(usHourInput.value) + 1) % 24;
            const nextReportingFormatted = String(nextReportingHour).padStart(2, '0');
            nextReportingElem.textContent = `Next reporting: ${nextReportingFormatted}:00 UST`;

            showToast(`Backlog template for ${backlogType === 'startDay' ? 'Start Day' : 'Intraday'} generated!`, 'success');
        }

        function updateBacklogTimes() {
            const usHourInput = document.getElementById('usHourInput');
            const nextReportingElem = document.getElementById('nextReporting');

            // Ensure inputs are valid numbers
            let currentUsHour = parseInt(usHourInput.value);
            if (isNaN(currentUsHour) || currentUsHour < 0 || currentUsHour > 23) {
                currentUsHour = 0; // Default to 0 if invalid
                usHourInput.value = 0;
            }

            // Update Next Reporting Time based on edited US hour
            let nextReportingHour = (currentUsHour + 1) % 24;
            const nextReportingFormatted = String(nextReportingHour).padStart(2, '0');
            nextReportingElem.textContent = `Next reporting: ${nextReportingFormatted}:00 UST`;
        }


        function copyBacklogTemplate() {
            const backlogOutputDiv = document.getElementById('backlogTemplateOutput');
            // Create a temporary textarea to hold the text content
            const tempTextArea = document.createElement('textarea');

            const mnlHour = document.getElementById('mnlHourInput').value;
            const mnlDate = document.getElementById('mnlDateDisplay').textContent.trim().substring(2); // Remove "- "
            const usHour = document.getElementById('usHourInput').value;
            const nextReporting = document.getElementById('nextReporting').textContent;
            const backlogAdditionalText = document.getElementById('backlogAdditionalText').textContent.trim();

            tempTextArea.value = `${document.getElementById('backlogTitle').textContent}\n` +
                                 `MNL Time: ${String(mnlHour).padStart(2, '0')}:00 ${mnlDate}\n` +
                                 `US Time: ${String(usHour).padStart(2, '0')}:00\n` +
                                 `${nextReporting}\n\n` +
                                 `BACKLOGS MONITORING\n` +
                                 `${backlogAdditionalText}`; // Directly add the static title and new text

            document.body.appendChild(tempTextArea);
            tempTextArea.select();
            document.execCommand('copy');
            document.body.removeChild(tempTextArea);
            showToast("Backlog template copied to clipboard!", 'success');
        }

        // Initial generation when the page loads if the tab is active
        document.addEventListener('DOMContentLoaded', () => {
            // ... existing DOMContentLoaded code ...
            if (document.getElementById('backlogTemplate').style.display !== 'none') {
                generateBacklogTemplate();
            }
        });

    </script>
</body>
</html>
